{% extends 'base.html' %}
{% block title %}Edit Entry{% endblock %}

{% block content %}
<h2 style="text-align:center; color:#8e2916; font-weight:800; letter-spacing:1px; font-size:1.55rem; margin-bottom:16px;">
    International Vaish Federation Andhra Pradesh Unit
</h2>
<h3 style="text-align:center; color:#d37933; font-family:'Noto Sans Telugu', serif; margin-top:-10px; font-size:1rem;">
    ఇంటర్నేషనల్ వైశ్య ఫెడరేషన్
</h3>

<form id="presentationForm" method="POST" style="margin-top:28px; max-width: 500px;" onsubmit="return validateForm()">
    {% csrf_token %}
    <div style="margin-bottom: 15px;">
        <label>Date: 
            <input type="date" name="date" required value="{% if entry %}{{ entry.date|date:'Y-m-d' }}{% else %}{{ today }}{% endif %}">
        </label>
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display:block; font-weight:600; margin-bottom: 5px;">Name:</label>
        <input type="text" name="toname" required 
            style="width: 100%; padding: 8px; box-sizing: border-box;" 
            value="{% if entry %}{{ entry.toname }}{% endif %}">
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display:block; font-weight:600; margin-bottom: 5px;">Phno:</label>
        <input type="text" name="phno" maxlength="10" required 
            style="width: 100%; padding: 8px; box-sizing: border-box;" 
            value="{% if entry %}{{ entry.phno }}{% endif %}">
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display:block; font-weight:600; margin-bottom: 5px;">Aadharno:</label>
        <input type="text" name="aadharno" maxlength="12" required 
            style="width: 100%; padding: 8px; box-sizing: border-box;" 
            value="{% if entry %}{{ entry.aadharno }}{% endif %}">
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display:block; font-weight:600; margin-bottom: 5px;">Appointment:</label>
        <select name="ap" required style="width: 100%; padding: 8px; box-sizing: border-box;">
            <option value="YUVAJANA VIBHAG DISTRICT MEMBER" {% if entry and entry.ap1 == "YUVAJANA VIBHAG DISTRICT MEMBER" %}selected{% endif %}>
                YUVAJANAVIBHAG DISTRICT MEMBER
            </option>
            <option value="YUVAJANA VIBHAG STATE MEMBER" {% if entry and entry.ap1 == "YUVAJANA VIBHAG STATE MEMBER" %}selected{% endif %}>
                YUVAJANAVIBHAG STATE MEMBER
            </option>
        </select>
    </div>
    <div style="margin-bottom: 15px;">
    <label style="display:block; font-weight:600; margin-bottom: 5px;">Committee:</label>
    <input type="text" name="committee" required style="width: 100%; padding: 8px; box-sizing: border-box;" value="{% if entry %}{{ entry.committee }}{% endif %}">
</div>

    <div style="margin-bottom: 15px;">
        <label style="display:block; font-weight:600; margin-bottom: 5px;">Designation:</label>
        <select name="aptdas" id="aptdas" required style="width: 100%; padding: 8px; box-sizing: border-box;">
            <option value="">Select Designation</option>
            <option value="President" {% if entry and entry.aptdas == "President" %}selected{% endif %}>President</option>
            <option value="Vice President" {% if entry and entry.aptdas == "Vice President" %}selected{% endif %}>Vice President</option>
            <option value="General Secretary" {% if entry and entry.aptdas == "General Secretary" %}selected{% endif %}>General Secretary</option>
            <option value="Addl. Secretary" {% if entry and entry.aptdas == "Addl. Secretary" %}selected{% endif %}>Addl. Secretary</option>
            <option value="Secretary" {% if entry and entry.aptdas == "Secretary" %}selected{% endif %}>Secretary</option>
            <option value="Treasurer" {% if entry and entry.aptdas == "Treasurer" %}selected{% endif %}>Treasurer</option>
            <option value="Joint Secretary" {% if entry and entry.aptdas == "Joint Secretary" %}selected{% endif %}>Joint Secretary</option>
            <option value="EC Member" {% if entry and entry.aptdas == "EC Member" %}selected{% endif %}>EC Member</option>
            <option value="State Committee Chairman" {% if entry and entry.aptdas == "State Committee Chairman" %}selected{% endif %}>State Committee Chairman</option>
            <option value="State Committee Director" {% if entry and entry.aptdas == "State Committee Director" %}selected{% endif %}>State Committee Director</option>
        </select>
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display:block; font-weight:600; margin-bottom: 5px;">AP District:</label>
        <select name="ap_district" id="ap_district" required style="width: 100%; padding: 8px; box-sizing: border-box;">
            {% if entry %}
            <option value="{{ entry.ap_district }}" selected>{{ entry.ap_district }}</option>
            {% else %}
            <option value="">Select District</option>
            {% endif %}
            <!-- Your JS will populate other districts -->
        </select>
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display:block; font-weight:600; margin-bottom: 5px;">AP Constitution:</label>
        <select name="ap_constitution" id="ap_constitution" required style="width: 100%; padding: 8px; box-sizing: border-box;">
            {% if entry %}
            <option value="{{ entry.ap_constitution }}" selected>{{ entry.ap_constitution }}</option>
            {% else %}
            <option value="">Select Constitution</option>
            {% endif %}
            <!-- JS updates after district changes -->
        </select>
    </div>

    <div style="margin-bottom: 20px;">
        <label style="display:block; font-weight:600; margin-bottom: 5px;">Address:</label>
        <textarea name="address" rows="4" cols="40" required style="width: 100%; padding: 8px; box-sizing: border-box;">{% if entry %}{{ entry.address }}{% endif %}</textarea>
    </div>

    <div style="margin-bottom: 15px;">
        <label style="display:block; font-weight:600; margin-bottom: 5px;">Pincode:</label>
        <input type="text" name="pincode" maxlength="10" required
            style="width: 100%; padding: 8px; box-sizing: border-box;"
            value="{% if entry %}{{ entry.pincode }}{% endif %}">
    </div>

    <button type="submit"
        style="background:#fbb216; color:#431c08; font-weight:700; border:none; border-radius:6px; padding:9px 38px; font-size:1rem; box-shadow:0 2px 5px #f0eaa6; cursor:pointer;">
        Update
    </button>
</form>

<script>
// Dictionary of districts and their constituencies
const CONSTITUENCIES_BY_DISTRICT = {
    "Srikakulam": ["Ichchapuram", "Palasa", "Tekkali", "Pathapatnam", "Srikakulam", "Amadalavalasa", "Etcherla", "Narasannapeta"],
    "Vizianagaram": ["Rajam", "Palakonda", "Kurupam", "Parvathipuram", "Salur", "Bobbili", "Cheepurupalli", "Gajapathinagaram", "Nellimarla", "Vizianagaram"],
    "Parvathipuram Manyam": ["Kurupam", "Parvathipuram", "Salur", "Araku Valley"],
    "Visakhapatnam": ["Srungavarapukota", "Bhimili", "Visakhapatnam East", "Visakhapatnam South", "Visakhapatnam North", "Visakhapatnam West", "Gajuwaka", "Chodavaram", "Elamanchili", "Pendurthi"],
    "Anakapalli": ["Madugula", "Anakapalle", "Pendurthi", "Payakaraopet", "Tuni", "Narsipatnam", "Chodavaram", "Pendurthi"],
    "Alluri Sitharama Raju": ["Araku Valley", "Paderu", "Rampachodravaram"],
    "Kakinada": ["Tuni", "Prathipadu", "Pithapuram", "Kakinada Rural", "Kakinada City", "Ramachandrapuram", "Mummidivaram"],
    "East Godavari": ["Anaparthy", "Kakinada City", "Ramachandrapuram", "Mummidivaram", "Razole", "Kothapeta", "Mandapeta"],
    "Konaseema": ["Amalapuram", "Razole", "Mummidivaram", "Kothapeta", "Ramachandrapuram", "Mummidivaram", "Kothapeta"],
    "West Godavari": ["Achanta", "Palakollu", "Bhimavaram", "Undi", "Tanuku", "Tadepalligudem", "Unguturu"],
    "Eluru": ["Unguturu", "Denduluru", "Polavaram", "Chintalapudi", "Tiruvuru", "Nuzvid", "Kaikalur"],
    "NTR": ["Nuzvid", "Gannavaram", "Kaikalur", "Pedana", "Machilipatnam", "Avanigadda", "Pamarru"],
    "Krishna": ["Gannavaram", "Gudivada", "Kaikalur", "Pedana", "Machilipatnam", "Avanigadda", "Pamarru"],
    "Guntur": ["Pedakurapadu", "Tadikonda", "Mangalagiri", "Ponnuru", "Vemuru", "Repalle", "Tenali"],
    "Palnadu": ["Chilakaluripet", "Narasaraopet", "Sattenapalle", "Vinukonda", "Gurazala", "Macherla", "Yerragondapalem"],
    "Bapatla": ["Darsi", "Parchur", "Addanki", "Chirala", "Santhanuthalapadu", "Ongole", "Markapuram"],
    "Prakasam": ["Yerragondapalem", "Darsi", "Parchur", "Addanki", "Chirala", "Santhanuthalapadu", "Ongole", "Kandukur", "Markapuram"],
    "Nellore": ["Kondapi", "Kavali", "Atmakur", "Nellore City", "Nellore Rural", "Udayagiri"],
    "Tirupati": ["Kavali", "Gudur", "Sullurpeta", "Nagari", "Tirupati", "Srikalahasti"],
    "Chittoor": ["Punganur", "Chandragiri", "Tirupati", "Satyavedu", "Nagari", "Chittoor", "Puthalapattu", "Palamaner", "Kuppam"],
    "Annamayya": ["Rajampet", "Kodur", "Rayachoti", "Thamballapalle", "Pileru", "Madanapalle"],
    "YSR Kadapa": ["Badvel", "Kadapa", "Rayachoti", "Pulivendla", "Kamalapuram", "Jammalamadugu", "Proddatur", "Mydukur"],
    "Nandyal": ["Allagadda", "Nandyal", "Nandikotkur", "Banaganapalle", "Dhone", "Pattikonda"],
    "Kurnool": ["Kurnool", "Pattikonda", "Adoni", "Alur", "Kodumur", "Yemmiganur", "Mantralayam"],
    "Ananthapuramu": ["Rayadurg", "Uravakonda", "Guntakal", "Tadipatri", "Singanamala", "Anantapur Urban", "Kalyandurg", "Hindupur"],
    "Sri Sathya Sai": ["Madakasira", "Hindupur", "Penukonda", "Puttaparthi", "Dharmavaram", "Kadiri"]
};

// Populate district dropdown
window.onload = function() {
    var apDistrict = document.getElementById('ap_district');
    for (let district in CONSTITUENCIES_BY_DISTRICT) {
        let opt = document.createElement('option');
        opt.value = district;
        opt.innerText = district;
        apDistrict.appendChild(opt);
    }
}

// When district changes, update constitutions
document.getElementById('ap_district').addEventListener('change', function() {
    var selected = this.value;
    var constitution = document.getElementById('ap_constitution');
    constitution.innerHTML = '<option value="">Select Constitution</option>';
    if (selected && CONSTITUENCIES_BY_DISTRICT[selected]) {
        CONSTITUENCIES_BY_DISTRICT[selected].forEach(function(c) {
            let opt = document.createElement('option');
            opt.value = c;
            opt.innerText = c;
            constitution.appendChild(opt);
        });
    }
});

// Frontend validation
function validateForm() {
    const form = document.getElementById("presentationForm");
    const date = form.elements["date"].value.trim();
    const toname = form.elements["toname"].value.trim();
    const phno = form.elements["phno"].value.trim();
    const aadharno = form.elements["aadharno"].value.trim();
    const ap = form.elements["ap"].value.trim();
    const aptdas = form.elements["aptdas"].value.trim();
    const apDistrict = form.elements["ap_district"].value.trim();
    const apConstitution = form.elements["ap_constitution"].value.trim();
    const address = form.elements["address"].value.trim();

    if (!date || !toname || !phno || !aadharno || !ap || !aptdas || !apDistrict || !apConstitution || !address) {
        alert("All fields are required.");
        return false;
    }
    const phnoPattern = /^\d{10}$/;
    if (!phnoPattern.test(phno)) {
        alert("Phone number must be exactly 10 digits.");
        return false;
    }
    const aadharPattern = /^\d{12}$/;
    if (!aadharPattern.test(aadharno)) {
        alert("Aadhar number must be exactly 12 digits.");
        return false;
    }
    return true;
}
</script>
{% endblock %}
